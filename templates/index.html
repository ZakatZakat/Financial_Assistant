<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Кастомное ASR</title>
</head>
<body>
<h1>Запись и распознавание речи</h1>
<button id="start">Начать запись</button>
<button id="stop">Остановить запись</button>
<div id="text"></div>


<button id="updateText">Обновить текст</button> <!-- Новая кнопка для обновления текста -->


<script>
let mediaRecorder;
let audioChunks = [];

document.getElementById('start').onclick = function() {
    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        mediaRecorder.ondataavailable = function(event) {
            audioChunks.push(event.data);
        };
    });
};

document.getElementById('stop').onclick = function() {
    mediaRecorder.stop();
    mediaRecorder.onstop = function() {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        sendAudioToServer(audioBlob);
        audioChunks = [];
    };
};

function sendAudioToServer(audioBlob) {
    const formData = new FormData();
    formData.append("audio", audioBlob);
    
    fetch("http://127.0.0.1:5000/api/upload-audio", {
        method: "POST",
        body: formData
    })
    .then(response => response.text())
    .then(data => {
        document.getElementById('text').innerText = data.text;
    });
}

document.getElementById('updateText').onclick = function() {
    fetch("http://127.0.0.1:5000/api/upload", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(text => {
        console.log("Received response text:", text); // Логирование текста ответа
    })
    .catch(error => {
        console.error("Error fetching data:", error); // Логирование ошибки, если запрос не удался
    });
};

</script>
</body>
</html>


